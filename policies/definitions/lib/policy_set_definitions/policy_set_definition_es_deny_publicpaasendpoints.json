{
  "name": "Deny-PublicPaaSEndpoints",
  "properties": {
    "description": "This policy initiative is a group of policies that prevents creation of Azure PaaS services with exposed public endpoints",
    "displayName": "Public network access should be disabled for PaaS services",
    "metadata": {
      "version": "1.5.0",
      "category": "Security"
    },
    "parameters": {
      "ACRPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access on Azure Container Registry disabled",
          "description": "This policy denies the creation of Azure Container Registires with exposed public endpoints "
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "AFSPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access on Azure File Sync disabled",
          "description": "This policy denies the creation of Azure File Sync instances with exposed public endpoints "
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "AKSPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access on AKS API should be disabled",
          "description": "This policy denies  the creation of  Azure Kubernetes Service non-private clusters"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "APIManagementServiceShouldUseASKUThatSupportsVirtualNetworksEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "Azure Attestation providers should use private endpoints Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "AuditIfNotExists",
          "Disabled"
        ],
        "defaultValue": "AuditIfNotExists"
      },
      "Azure Cache for Redis should disable public network access Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "Azure Cognitive Search services should disable public network access Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "Azure SignalR Service should disable public network access Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "Azure Synapse workspaces should disable public network access Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "BatchPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access should be disabled for Azure Batch Instances",
          "description": "This policy denies creation of Azure Batch Instances with exposed public endpoints"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "Configure API Management services to disable public network access Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "DeployIfNotExists",
          "Disabled"
        ],
        "defaultValue": "DeployIfNotExists"
      },
      "CosmosPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access should be disabled for CosmosDB",
          "description": "This policy denies that  Cosmos database accounts  are created with out public network access is disabled."
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "IoT Hub device provisioning service instances should disable public network access Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "KeyVaultPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access should be disabled for KeyVault",
          "description": "This policy denies creation of Key Vaults with IP Firewall exposed to all public endpoints"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "KeyVaultPublicNetworkDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Azure Key Vault should disable public network access",
          "description": "Disable public network access for your key vault so that it's not accessible over the public internet. This can reduce data leakage risks. Learn more at: https://aka.ms/akvprivatelink."
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Audit"
      },
      "MariaDBIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access should be disabled for MariaDB",
          "description": "This policy denies the creation of Maria DB accounts with exposed public endpoints"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "MySQLFlexPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access should be disabled for MySQL Flexible Server",
          "description": "This policy denies creation of MySql Flexible Server DB accounts with exposed public endpoints"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "MySQLIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access should be disabled for MySQL servers",
          "description": "Disable the public network access property to improve security and ensure your Azure Database for MySQL can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules."
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "PostgreSQLFlexPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access should be disabled for PostgreSql Flexible Server",
          "description": "This policy denies creation of Postgre SQL Flexible DB accounts with exposed public endpoints"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "PostgreSQLIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access should be disabled for MySQL servers",
          "description": "Disable the public network access property to improve security and ensure your Azure Database for MySQL can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules."
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "Public network access on Azure Data Factory should be disabled Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "Public network access on Azure IoT Hub should be disabled Effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "SqlServerPublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access on Azure SQL Database should be disabled",
          "description": "This policy denies creation of Sql servers with exposed public endpoints"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "Storage account public access should be disallowed Effect": {
        "type": "String",
        "metadata": {
          "displayName": "[Preview]: Storage account public access should be disallowed",
          "description": "Anonymous public read access to containers and blobs in Azure Storage is a convenient way to share data but might present security risks. To prevent data breaches caused by undesired anonymous access, Microsoft recommends preventing public access to a storage account unless your scenario requires it."
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "StoragePublicIpDenyEffect": {
        "type": "String",
        "metadata": {
          "displayName": "Public network access onStorage accounts should be disabled",
          "description": "This policy denies creation of storage accounts with IP Firewall exposed to all public endpoints"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      }
    },
    "policyDefinitions": [
      {
        "policyDefinitionReferenceId": "[Preview]: Storage account public access should be disallowed",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/4fa4b6c0-31ca-4c0d-b10d-24b96f62a751",
        "parameters": {
          "effect": {
            "value": "[[parameters('Storage account public access should be disallowed Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "ACRDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/0fdf0491-d080-4575-b627-ad0e843cba0f",
        "parameters": {
          "effect": {
            "value": "[[parameters('ACRPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "AFSDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/21a8cd35-125e-4d13-b82d-2e19b7208bb7",
        "parameters": {
          "effect": {
            "value": "[[parameters('AFSPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "AKSDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/040732e8-d947-40b8-95d6-854c95024bf8",
        "parameters": {
          "effect": {
            "value": "[[parameters('AKSPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "APIManagementServiceShouldUseASKUThatSupportsVirtualNetworks",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/73ef9241-5d81-4cd4-b483-8443d1730fe5",
        "parameters": {
          "effect": {
            "value": "[[parameters('APIManagementServiceShouldUseASKUThatSupportsVirtualNetworksEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Azure Attestation providers should use private endpoints",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/7b256a2d-058b-41f8-bed9-3f870541c40a",
        "parameters": {
          "effect": {
            "value": "[[parameters('Azure Attestation providers should use private endpoints Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Azure Cache for Redis should disable public network access",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/470baccb-7e51-4549-8b1a-3e5be069f663",
        "parameters": {
          "effect": {
            "value": "[[parameters('Azure Cache for Redis should disable public network access Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Azure Cognitive Search services should disable public network access",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/ee980b6d-0eca-4501-8d54-f6290fd512c3",
        "parameters": {
          "effect": {
            "value": "[[parameters('Azure Cognitive Search services should disable public network access Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Azure SignalR Service should disable public network access",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/21a9766a-82a5-4747-abb5-650b6dbba6d0",
        "parameters": {
          "effect": {
            "value": "[[parameters('Azure SignalR Service should disable public network access Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Azure Synapse workspaces should disable public network access",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/38d8df46-cf4e-4073-8e03-48c24b29de0d",
        "parameters": {
          "effect": {
            "value": "[[parameters('Azure Synapse workspaces should disable public network access Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "BatchDenyPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/74c5a0ae-5e48-4738-b093-65e23a060488",
        "parameters": {
          "effect": {
            "value": "[[parameters('BatchPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Configure API Management services to disable public network access",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/7ca8c8ac-3a6e-493d-99ba-c5fa35347ff2",
        "parameters": {
          "effect": {
            "value": "[[parameters('Configure API Management services to disable public network access Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "CosmosDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/797b37f7-06b8-444c-b1ad-fc62867f335a",
        "parameters": {
          "effect": {
            "value": "[[parameters('CosmosPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Deny-PublicEndpoint-MariaDB",
        "policyDefinitionId": "${targetManagementGroupResourceId}/providers/Microsoft.Authorization/policyDefinitions/Deny-PublicEndpoint-MariaDB",
        "parameters": {
          "effect": {
            "value": "[[parameters('MariaDBIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "IoT Hub device provisioning service instances should disable public network access",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/d82101f3-f3ce-4fc5-8708-4c09f4009546",
        "parameters": {
          "effect": {
            "value": "[[parameters('IoT Hub device provisioning service instances should disable public network access Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "KeyVaultDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490",
        "parameters": {
          "effect": {
            "value": "[[parameters('KeyVaultPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "KeyVaultDenyPaasPublicNetwork",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/405c5871-3e91-4644-8a63-58e19d68ff5b",
        "parameters": {
          "effect": {
            "value": "[[parameters('KeyVaultPublicNetworkDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "MySQLDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/d9844e8a-1437-4aeb-a32c-0c992f056095",
        "parameters": {
          "effect": {
            "value": "[[parameters('MySQLIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "MySQLFlexDenyPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/c9299215-ae47-4f50-9c54-8a392f68a052",
        "parameters": {
          "effect": {
            "value": "[[parameters('MySQLFlexPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "PostgreSQLDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/b52376f7-9612-48a1-81cd-1ffe4b61032c",
        "parameters": {
          "effect": {
            "value": "[[parameters('PostgreSQLIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "PostgreSQLFlexDenyPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/5e1de0e3-42cb-4ebc-a86d-61d0c619ca48",
        "parameters": {
          "effect": {
            "value": "[[parameters('PostgreSQLFlexPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Public network access on Azure Data Factory should be disabled",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1cf164be-6819-4a50-b8fa-4bcaa4f98fb6",
        "parameters": {
          "effect": {
            "value": "[[parameters('Public network access on Azure Data Factory should be disabled Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "Public network access on Azure IoT Hub should be disabled",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/2d6830fb-07eb-48e7-8c4d-2a442b35f0fb",
        "parameters": {
          "effect": {
            "value": "[[parameters('Public network access on Azure IoT Hub should be disabled Effect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "SqlServerDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/1b8ca024-1d5c-4dec-8995-b1a932b41780",
        "parameters": {
          "effect": {
            "value": "[[parameters('SqlServerPublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      },
      {
        "policyDefinitionReferenceId": "StorageDenyPaasPublicIP",
        "policyDefinitionId": "/providers/Microsoft.Authorization/policyDefinitions/34c877ad-507e-4c82-993e-3452a6e0ad3c",
        "parameters": {
          "effect": {
            "value": "[[parameters('StoragePublicIpDenyEffect')]"
          }
        },
        "groupNames": []
      }
    ]
  },
  "scope": null,
  "type": "Microsoft.Authorization/policySetDefinitions"
}
